<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>LifeDex</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- React -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <style>
    body {
      margin: 0;
      background: radial-gradient(#0b1220, #05080f);
      font-family: system-ui, sans-serif;
      color: white;
    }

    #root {
      max-width: 420px;
      margin: auto;
      padding: 20px;
    }

    h1 { font-size: 32px; margin-bottom: 4px; }

    button {
      background: orange;
      border: none;
      padding: 12px 16px;
      border-radius: 20px;
      font-weight: bold;
      margin: 6px 6px 6px 0;
      cursor: pointer;
    }

    .back-btn {
      position: sticky;
      top: 0;
      z-index: 1000;
      background: gold;
      color: black;
      width: 100%;
      border-radius: 0 0 16px 16px;
      margin-bottom: 16px;
    }

    .dex {
      background: linear-gradient(180deg,#101827,#05080f);
      border-radius: 18px;
      padding: 16px;
      margin: 16px 0;
    }

    .bar {
      background: #222;
      border-radius: 10px;
      height: 8px;
      overflow: hidden;
      margin: 8px 0;
    }

    .fill {
      height: 100%;
      background: linear-gradient(90deg,#00ff88,#00bbff);
    }

    input {
      width: 100%;
      padding: 10px;
      border-radius: 10px;
      border: none;
      margin-top: 8px;
    }
  </style>
</head>

<body>
<div id="root"></div>

<script type="text/babel">
const LEVELS = ["Beginner","Practitioner","Advanced","Expert","Master"];

function App() {
  const [dexes, setDexes] = React.useState(() => [
    { id: 1, name: "LifeDoc", type: "Skill", xp: 95, moments: [] },
    { id: 2, name: "BlueCollar Trades", type: "Career", xp: 20, moments: [] },
    { id: 3, name: "Reliability", type: "Trait", xp: 40, moments: [] },
    { id: 4, name: "Artistry", type: "Hobby", xp: 5, moments: [] }
  ]);

  const [screen, setScreen] = React.useState("main"); // "main" | "log"
  const [activeDexId, setActiveDexId] = React.useState(null);

  const addXP = (id, amount, note) => {
    setDexes(dexes =>
      dexes.map(d =>
        d.id === id
          ? {
              ...d,
              xp: d.xp + amount,
              moments: note
                ? [...d.moments, { text: note, xp: amount }]
                : d.moments
            }
          : d
      )
    );
  };

  /* =======================
     LOG SCREEN (WITH BACK)
     ======================= */
  if (screen === "log") {
    const dex = dexes.find(d => d.id === activeDexId);

    return (
      <div>
        <button
          className="back-btn"
          onClick={() => {
            setScreen("main");
            setActiveDexId(null);
          }}
        >
          ← Back to LifeDex
        </button>

        <h2>{dex.name} — Capture Log</h2>

        {dex.moments.length === 0 && (
          <p>No captures yet.</p>
        )}

        {dex.moments.slice().reverse().map((m, i) => (
          <div key={i} className="dex">
            <strong>+{m.xp} XP</strong>
            <p>{m.text}</p>
          </div>
        ))}
      </div>
    );
  }

  /* =======================
     MAIN SCREEN
     ======================= */
  return (
    <div>
      <h1>LifeDex</h1>
      <p>Your life, indexed.</p>

      {dexes.map(d => {
        const level =
          LEVELS[Math.floor(d.xp / 100)] || LEVELS[LEVELS.length - 1];

        return (
          <div key={d.id} className="dex">
            <h2>{d.name}</h2>
            <p>{d.type} • {level}</p>

            <div className="bar">
              <div
                className="fill"
                style={{ width: (d.xp % 100) + "%" }}
              />
            </div>

            <button onClick={() => addXP(d.id, 10)}>
              + XP
            </button>

            <button
              onClick={() => {
                setActiveDexId(d.id);
                setScreen("log");
              }}
            >
              View Log
            </button>

            <input
              placeholder="Capture moment (press Enter)"
              onKeyDown={e => {
                if (e.key === "Enter" && e.target.value.trim()) {
                  addXP(d.id, 5, e.target.value);
                  e.target.value = "";
                }
              }}
            />
          </div>
        );
      })}
    </div>
  );
}

ReactDOM.createRoot(document.getElementById("root")).render(<App />);
</script>
</body>
</html>
